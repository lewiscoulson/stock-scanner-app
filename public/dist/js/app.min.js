!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("../models/stock.js");b.exports=Backbone.Collection.extend({model:d,url:"stocks/"})},{"../models/stock.js":3}],2:[function(a,b,c){window.APP=window.APP||{};var d=a("./routers/main.js");$.getJSON("https://spreadsheets.google.com/feeds/list/0AhySzEddwIC1dEtpWF9hQUhCWURZNEViUmpUeVgwdGc/1/public/basic?alt=json",function(a){for(var b,c=a.feed.entry,e={},f=0;f<c.length;f++)b=c[f],e[b.title.$t.split(".")[0]]=parseInt(b.content.$t.split(",")[1].split(": ")[1],10);APP.ftse100=e,new d,Backbone.history.start()})},{"./routers/main.js":4}],3:[function(a,b,c){var d=Backbone.Model.extend({idAttribute:"_id",defaults:{currentPrice:0,priceDifference:0}});b.exports=d},{}],4:[function(a,b,c){var d=a("../collections/stocks.js"),e=a("../views/stocks.js"),f=a("../views/new_stock.js"),g=Backbone.Router.extend({routes:{"":"index","new":"new"},index:function(){APP.stocks_collection=new d,APP.stocks_collection.fetch({success:function(){new e({collection:APP.stocks_collection}),console.log(APP.stocks_collection)},error:function(){console.log("error fetching stocks")}})},"new":function(){new f}});b.exports=g},{"../collections/stocks.js":1,"../views/new_stock.js":5,"../views/stocks.js":7}],5:[function(a,b,c){var d=Backbone.View.extend({initialize:function(){this.render()},render:function(){$(".stocks").html(""),$(".new-stock").show()}});b.exports=d},{}],6:[function(a,b,c){var d=Backbone.View.extend({template:_.template('<h2><%= companyName %></h2><p><strong>target price:</strong> <%= targetPrice %> / <strong>current price</strong> <%= currentPrice %></p><p><%= priceDifference %>% overpriced</p> <button class="edit-stock btn btn-default">Edit</button> <button class="delete-stock btn btn-default">Delete</button><div class="edit-area"><input name="companyName" class="company-name" value="<%= companyName %>" type="text" /><input name="targetPrice" class="target-price" value="<%= targetPrice %>" type="text" /><button class="done-editing btn btn-default">Done</button></div>'),events:{"click .edit-stock":"showEditArea","click .delete-stock":"deleteStock","click .done-editing":"hideEditArea"},deleteStock:function(a){a.preventDefault(),this.model.destroy({success:function(a,b){console.log("success"),console.log(a),console.log(b)},error:function(a,b){console.log("error"),console.log(a),console.log(b)}})},showEditArea:function(a){a.preventDefault(),this.$el.find(".edit-area").show()},hideEditArea:function(a){a.preventDefault(),this.updateModel(),this.$el.find(".edit-area").hide()},updateModel:function(){this.model.save({companyName:this.$el.find(".company-name").val(),targetPrice:this.$el.find(".target-price").val()})},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}});b.exports=d},{}],7:[function(a,b,c){var d=a("./stock.js"),e=Backbone.View.extend({el:".stocks",initialize:function(){this.updateStockvalues(),this.render(),this.listenTo(this.collection,"sort",this.render),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"destroy",this.render)},events:{"click .most-undervalued":"mostUndervalued","click .most-overvalued":"mostOvervalued"},mostUndervalued:function(a){a.preventDefault(),this.collection.comparator="priceDifference",this.collection.sort()},mostOvervalued:function(a){a.preventDefault(),this.collection.comparator=function(a){return-a.get("priceDifference")},this.collection.sort()},updateStockvalues:function(){this.collection.each(function(a){function b(a,b){return Math.floor(100*(b/a-1))}var c=a.get("symbol").toUpperCase();APP.ftse100[c]&&(a.set("currentPrice",APP.ftse100[c]),a.set("priceDifference",b(a.get("targetPrice"),APP.ftse100[c])))})},render:function(){$(".new-stock").hide(),this.$el.html(""),this.$el.append('<h2>sort by:</h2> <a href="#" class="most-undervalued">most undervalued</a> <a href="#" class="most-overvalued">most overvalued</a>'),this.collection.each(function(a){this.renderStock(a)},this)},renderStock:function(a){var b=new d({model:a});this.$el.append(b.render().el)}});b.exports=e},{"./stock.js":6}]},{},[2,3,1,4,5,6,7]);